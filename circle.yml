
machine:
  environment:
    CONFIG_NAME: testing
  python:
    version: 3.5.2

dependencies:
  override:
    - pip install -r requirements.txt
    - aws s3 cp s3://albatross.api.config/test_environment_variables.sh ./environment_variables.sh

test:
  override:
    - source ./environment_variables.sh
      && export DB_HOST="127.0.0.1"
      && export DB_NAME="circle_test"
      && export DB_PORT=5432
      && export DB_USER="ubuntu"
      && cd ./albatross
      && python ./manage.py test

deployment:
  master:
     branch: master
     commands:
       - ssh -p 50005 -i /home/ubuntu/.ssh/id_production deploy@34.195.47.179 "/var/www/albatross_api/atomic_deployments.sh